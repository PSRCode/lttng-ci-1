- defaults:
    name: libdelorean-java-mvn
    description: |
      Nightly build of libdelorean Java.

      <p>Job is managed by Jenkins Job Builder.</p>

    project-type: maven

    maven:
      goals: 'clean install'
      private-repository: 'local-to-workspace'
      automatic-fingerprinting: false
      per-module-email: false
      settings: 'org.jenkinsci.plugins.configfiles.maven.MavenSettingsConfig277b7a2d-b7a6-4ae4-a32d-18c02514e9e4'
      settings-type: cfp

    wrappers:
      - workspace-cleanup
      - timestamps
      - ansicolor

    scm:
      - git:
          url: git://github.com/{github_user}/{github_name}.git
          browser: githubweb
          browser-url: https://github.com/{github_user}/{github_name}
          branches:
            - origin/{version}
          skip-tag: true

    triggers:
      - pollscm:
          cron: "@hourly"

    properties:
      - build-discarder:
          num-to-keep: 2
      - github:
          url: https://github.com/{github_user}/{github_name}

- defaults:
    name: libdelorean-java
    description: |
      Nightly build of libdelorean Java.

      <p>Job is managed by Jenkins Job Builder.</p>

    project-type: freestyle

    wrappers:
      - workspace-cleanup
      - timestamps
      - ansicolor

    scm:
      - git:
          url: git://github.com/{github_user}/{github_name}.git
          browser: githubweb
          browser-url: https://github.com/{github_user}/{github_name}
          branches:
            - origin/{version}
          skip-tag: true

    triggers:
      - pollscm:
          cron: "@hourly"

    properties:
      - build-discarder:
          num-to-keep: 2
      - github:
          url: https://github.com/{github_user}/{github_name}


## Templates
- job-template:
    name: libdelorean-java_{version}_build
    defaults: libdelorean-java-mvn

    publishers:
      - warnings:
          console-log-parsers:
            - 'Maven'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - workspace-cleanup
      - email-ext:
          recipients: alex@voxpopuli.im
          matrix-trigger: only-parent

- job-template:
    name: libdelorean-java_{version}_coverity
    defaults: libdelorean-java
    node: 'x86-64'

    triggers:
      - pollscm:
          cron: "@daily"

    wrappers:
      - workspace-cleanup
      - timestamps
      - ansicolor:
          colormap: xterm
      - credentials-binding:
          - username-password-separated:
              credential-id: libdelorean-java_coverity_token
              username: COVERITY_SCAN_PROJECT_NAME
              password: COVERITY_SCAN_TOKEN

    scm:
      - git:
          url: git://github.com/{github_user}/{github_name}.git
          browser: githubweb
          browser-url: https://github.com/{github_user}/{github_name}
          branches:
            - origin/{version}
          skip-tag: true
          basedir: src/libdelorean-java

    builders:
      - maven-target:
          maven-version: "default"
          goals: "-version"
          private-repository: true
          settings: 'org.jenkinsci.plugins.configfiles.maven.MavenSettingsConfig277b7a2d-b7a6-4ae4-a32d-18c02514e9e4'
      - shell:
          !include-raw-escape: scripts/common/coverity.sh

    publishers:
      - workspace-cleanup
      - archive:
          artifacts: 'analysis-results.tgz,cov-int/**'
          allow-empty: false


## Project
- project:
    name: libdelorean-java
    github_user: efficios
    github_name: libdelorean-java
    version:
      - master
    jobs:
      - 'libdelorean-java_{version}_build'
      - 'libdelorean-java_{version}_coverity':
          version: master
