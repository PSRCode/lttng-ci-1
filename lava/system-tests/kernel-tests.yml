metadata:
        format: Lava-Test Test Definition 1.0
        name: lttng-kernel-test
        description: "Run kernel test suite"
install:
        steps:
                - export TMPDIR="/tmp"
                - cd
                - ulimit -c unlimited
                - mkdir -p coredump
                - echo "$(pwd)/coredump/core.%e.%p.%h.%t" > /proc/sys/kernel/core_pattern
run:
        steps:
                - bash
                - source /root/lttngvenv/activate
                - cd /root/lttngvenv/src/lttng-tools
                - lava-test-case build-test-suite --shell "make"
                - cd tests
                - lava-test-case run-tests --shell "prove --verbose --merge --exec '' - < root_regression"
                - cd
                - tar czf coredump.tar.gz coredump
                - lava-test-case-attach run-tests coredump.tar.gz
